(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{365:function(s,t,a){s.exports=a.p+"assets/img/1.8e2df4b7.png"},366:function(s,t,a){s.exports=a.p+"assets/img/2.54481945.png"},367:function(s,t,a){s.exports=a.p+"assets/img/3.5511aa1c.png"},368:function(s,t,a){s.exports=a.p+"assets/img/4.d62cc9bd.png"},369:function(s,t,a){s.exports=a.p+"assets/img/5.7e39de74.png"},370:function(s,t,a){s.exports=a.p+"assets/img/6.e312ed78.png"},371:function(s,t,a){s.exports=a.p+"assets/img/7.4a98cff0.png"},372:function(s,t,a){s.exports=a.p+"assets/img/8.648e80a1.png"},373:function(s,t,a){s.exports=a.p+"assets/img/9.615b83ce.png"},374:function(s,t,a){s.exports=a.p+"assets/img/10.3a776f30.png"},375:function(s,t,a){s.exports=a.p+"assets/img/11.51aa4289.png"},823:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"基于ldap实现统一认证服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于ldap实现统一认证服务"}},[s._v("#")]),s._v(" 基于LDAP实现统一认证服务")]),s._v(" "),t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("p",[s._v("应用 系统在用户管理上 存在 的问题 ，提 出统一 用户认 证解 决方案。利用 LDAP 目录服务，构建一套统一的身份认证机制及网络应用资源管理模式，实现对用户的统一身份认证、单点登录、集中鉴权以及对 网络应用资源的统一管理 。")]),s._v(" "),t("p",[s._v("关键词 目录服务 ，统一身份认证 ，单点登 录，集 中鉴权")]),s._v(" "),t("h2",{attrs:{id:"链接资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#链接资料"}},[s._v("#")]),s._v(" 链接资料")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("基于LDAP的统一用户认证系统设计与实现 设计文档")])]),s._v(" "),t("p",[s._v("https://www.jsjkx.com/CN/article/openArticlePDF.jsp?id=8940")])]),s._v(" "),t("li",[t("p",[s._v("ldap go语言实现数据库结构 客户端")]),s._v(" "),t("p",[s._v("https://github.com/eryajf/go-ldap-admin/tree/main/model")])]),s._v(" "),t("li",[t("p",[s._v("python-ldap第三方安装包")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.python-ldap.org/en/python-ldap-3.4.2/",target:"_blank",rel:"noopener noreferrer"}},[s._v("python-ldap - python-ldap 3.4.2 documentation"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/linxiyue/p/10250243.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Python使用LDAP做用户认证"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/linxiyue/p/10250243.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Python使用LDAP做用户认证"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[s._v("openldap搭建和配置")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/woshimrf/p/ldap.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("openldap介绍和使用"),t("OutboundLink")],1)])])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("csdn java\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csdn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("net"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("u013310119"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("article"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("details"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("109402932")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n乾颐堂"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("python操作ldap微软域 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("gitee"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("qytang"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("VIP_LDAP3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  \n\ndjango对接 官网ldap\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("django"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("readthedocs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("en"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("latest"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("install"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n对接企业微信\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csdn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("net"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("weixin_43881394"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("article"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("details"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("109116711")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n搭建openldap\n  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("www"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cnblogs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lcword"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14434499")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h2",{attrs:{id:"_1-ldap概念和原理介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-ldap概念和原理介绍"}},[s._v("#")]),s._v(" 1. "),t("strong",[s._v("LDAP概念和原理介绍")])]),s._v(" "),t("p",[s._v("相信对于许多的朋友来说，可能听说过LDAP，但是实际中对LDAP的了解和具体的原理可能还比较模糊，今天就从“什么是LDAP”、“LDAP的主要产品”、“LDAP的基本模型”、“LDAP的使用案例”四个方面来做一个介绍。")]),s._v(" "),t("p",[s._v("我们在开始介绍之前先来看几个问题：")]),s._v(" "),t("ol",[t("li",[s._v("我们日常的办公系统是不是有多个？")]),s._v(" "),t("li",[s._v("每个系统之间是不是都有独立的账号密码？")]),s._v(" "),t("li",[s._v("密码多了，有时候半天想不起来哪个密码对应哪个系统？")]),s._v(" "),t("li",[s._v("每次新项目的开发，都需要重新开发和维护一套用户密码？")]),s._v(" "),t("li",[s._v("维护多套系统的用户是不是非常头疼？")])]),s._v(" "),t("p",[s._v("So，如今大家再也不用为上面的的问题头疼了，因为“LDAP统一认证服务”已经帮助大家解决这些问题了。那么相信大家对“LDAP统一认证服务”是干嘛的已经有一个大概的了解了吧？")]),s._v(" "),t("h3",{attrs:{id:"_1-1-什么是ldap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-什么是ldap"}},[s._v("#")]),s._v(" 1.1 "),t("strong",[s._v("什么是LDAP？")])]),s._v(" "),t("p",[t("strong",[s._v("（一）在介绍什么是LDAP之前，我们先来复习一个东西：“什么是目录服务？")]),s._v("”")]),s._v(" "),t("ol",[t("li",[s._v("目录服务是一个特殊的数据库，用来保存描述性的、基于属性的详细信息，支持过滤功能。")]),s._v(" "),t("li",[s._v("是动态的，灵活的，易扩展的。")])]),s._v(" "),t("p",[s._v("如：人员组织管理，电话簿，地址簿。")]),s._v(" "),t("p",[t("strong",[s._v("（二）了解完目录服务后，我们再来看看LDAP的介绍：")])]),s._v(" "),t("p",[t("strong",[s._v("LDAP是轻量目录访问协议")]),s._v("，英文全称是"),t("strong",[s._v("Lightweight Directory Access Protocol")]),s._v("，一般都简称为LDAP。按照我们对文件目录的理解，ldap可以看成一个文件系统，类似目录和文件树。")]),s._v(" "),t("p",[s._v("目录是一个为查询、浏览和搜索而优化的数据库，它成树状结构组织数据，类似文件目录一样。")]),s._v(" "),t("p",[s._v("LDAP目录服务是由目录数据库和一套访问协议组成的系统。")]),s._v(" "),t("p",[s._v("目录数据库和关系数据库不同，它有优异的读性能，但写性能差，并且没有事务处理、回滚等复杂功能，不适于存储修改频繁的数据。所以目录天生是用来查询的，就好象它的名字一样。")]),s._v(" "),t("p",[t("strong",[s._v("（三）为什么要使用")])]),s._v(" "),t("p",[s._v("LDAP是开放的Internet标准，支持跨平台的Internet协议，在业界中得到广泛认可的，并且市场上或者开源社区上的大多产品都加入了对LDAP的支持，因此对于这类系统，不需单独定制，只需要通过LDAP做简单的配置就可以与服务器做认证交互。“简单粗暴”，可以大大降低重复开发和对接的成本。")]),s._v(" "),t("p",[s._v("我们拿开源系统（YAPI）做案例，只需做一下简单的几步配置就可以达到LDAP的单点登录认证了：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ldapLogin"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"enable"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" true"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"server"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ldap://l-ldapt1.ops.dev.cn0.qunar.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"baseDn"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN=Admin,CN=Users,DC=test,DC=com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bindPassword"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password123"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"searchDn"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU=UserContainer,DC=test,DC=com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"searchStandard"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mail"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[t("img",{attrs:{src:a(365),alt:""}})]),s._v(" "),t("h3",{attrs:{id:"_1-2-ldap的主要产品"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-ldap的主要产品"}},[s._v("#")]),s._v(" 1.2 "),t("strong",[s._v("LDAP的主要产品")])]),s._v(" "),t("p",[s._v("细心的朋友应该会主要到，LDAP的中文全称是：轻量级目录访问协议，说到底LDAP仅仅是一个访问协议，那么我们的数据究竟存储在哪里呢？")]),s._v(" "),t("p",[s._v("来，我们一起看下下面的表格：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("厂商")]),s._v(" "),t("th",[s._v("产品")]),s._v(" "),t("th",[s._v("介绍")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("SUN")]),s._v(" "),t("td",[s._v("SUNONE Directory Server")]),s._v(" "),t("td",[s._v("基于文本数据库的存储，速度快 。")])]),s._v(" "),t("tr",[t("td",[s._v("IBM")]),s._v(" "),t("td",[s._v("IBM Directory Server")]),s._v(" "),t("td",[s._v("基于DB2 的的数据库，速度一般。")])]),s._v(" "),t("tr",[t("td",[s._v("Novell")]),s._v(" "),t("td",[s._v("Novell Directory Server")]),s._v(" "),t("td",[s._v("基于文本数据库的存储，速度快, 不常用到。")])]),s._v(" "),t("tr",[t("td",[s._v("Microsoft")]),s._v(" "),t("td",[s._v("Microsoft Active Directory")]),s._v(" "),t("td",[s._v("基于WINDOWS系统用户，对大数据量处理速度一般，但维护容易，生态圈大，管理相对简单。")])]),s._v(" "),t("tr",[t("td",[s._v("Opensource")]),s._v(" "),t("td",[s._v("Opensource")]),s._v(" "),t("td",[s._v("OpenLDAP 开源的项目，速度很快，但是非主 流应用。")])])])]),s._v(" "),t("p",[s._v("没错，这就是正常存储数据的地方，而访问这些数据就是通过我们上述所说的LDAP。相信到这里大家应该了解两者之间的关系了吧！")]),s._v(" "),t("h3",{attrs:{id:"_1-3-ldap的基本模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ldap的基本模型"}},[s._v("#")]),s._v(" 1.3 "),t("strong",[s._v("LDAP的基本模型")])]),s._v(" "),t("p",[s._v("每一个系统、协议都会有属于自己的模型，LDAP也不例外，在了解LDAP的基本模型之前我们需要先了解几个LDAP的目录树概念：")]),s._v(" "),t("p",[t("strong",[s._v("（一）目录树概念")])]),s._v(" "),t("ol",[t("li",[s._v("目录树：在一个目录服务系统中，整个目录信息集可以表示为一个目录信息树，树中的每个节点是一个条目。")])]),s._v(" "),t("p",[s._v("\\2. 条目：每个条目就是一条记录，每个条目有自己的唯一可区别的名称（DN）。")]),s._v(" "),t("ol",[t("li",[s._v("对象类：与某个实体类型对应的一组属性，对象类是可以继承的，这样父类的必须属性也会被继承下来。")]),s._v(" "),t("li",[s._v("属性：描述条目的某个方面的信息，一个属性由一个属性类型和一个或多个属性值组成，属性有必须属性和非必须属性。")])]),s._v(" "),t("p",[t("strong",[s._v("（二）DC、UID、OU、CN、SN、DN、RDN")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("关键字")]),s._v(" "),t("th",[s._v("英文全称")]),s._v(" "),t("th",[s._v("含义")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("dc")]),s._v(" "),t("td",[s._v("Domain Component")]),s._v(" "),t("td",[s._v("域名的部分，其格式是将完整的域名分成几部分，如域名为example.com变成dc=example,dc=com（一条记录的所属位置）")])]),s._v(" "),t("tr",[t("td",[s._v("uid")]),s._v(" "),t("td",[s._v("User Id")]),s._v(" "),t("td",[s._v("用户ID songtao.xu（一条记录的ID）")])]),s._v(" "),t("tr",[t("td",[s._v("ou")]),s._v(" "),t("td",[s._v("Organization Unit")]),s._v(" "),t("td",[s._v("组织单位，组织单位可以包含其他各种对象（包括其他组织单元），如“oa组”（一条记录的所属组织）")])]),s._v(" "),t("tr",[t("td",[s._v("cn")]),s._v(" "),t("td",[s._v("Common Name")]),s._v(" "),t("td",[s._v("公共名称，如“Thomas Johansson”（一条记录的名称）")])]),s._v(" "),t("tr",[t("td",[s._v("sn")]),s._v(" "),t("td",[s._v("Surname")]),s._v(" "),t("td",[s._v("姓，如“许”")])]),s._v(" "),t("tr",[t("td",[s._v("dn")]),s._v(" "),t("td",[s._v("Distinguished Name")]),s._v(" "),t("td",[s._v("“uid=songtao.xu,ou=oa组,dc=example,dc=com”，一条记录的位置（唯一）")])]),s._v(" "),t("tr",[t("td",[s._v("rdn")]),s._v(" "),t("td",[s._v("Relative dn")]),s._v(" "),t("td",[s._v("相对辨别名，类似于文件系统中的相对路径，它是与目录树结构无关的部分，如“uid=tom”或“cn= Thomas Johansson”")])])])]),s._v(" "),t("p",[t("strong",[s._v("（三）基本模型：")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("信息模型：")])])]),s._v(" "),t("p",[t("img",{attrs:{src:a(366),alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("命名模型：")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(367),alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("功能模型：")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(368),alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("安全模型：")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(369),alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("四、LDAP的使用")])]),s._v(" "),t("p",[s._v("那我们是如何访问LDAP的数据库服务器呢？")]),s._v(" "),t("p",[t("img",{attrs:{src:a(370),alt:""}})]),s._v(" "),t("p",[s._v("统一身份认证主要是改变原有的认证策略，使需要认证的软件都通过LDAP进行认证，在统一身份认证之后，用户的所有信息都存储在AD Server中。终端用户在需要使用公司内部服务的时候，都需要通过AD服务器的认证。")]),s._v(" "),t("p",[s._v("那么程序中是如何访问的呢？ 我们以PHP脚本作为例子：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('$ldapconn = ldap_connect(“10.1.8.78") $ldapbind = ldap_bind($ldapconn, \'username\', $ldappass); $searchRows= ldap_search($ldapconn, $basedn, "(cn=*)"); $searchResult = ldap_get_entries($ldapconn, $searchRows); ldap_close($ldapconn);\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",[t("li",[s._v("连接到LDAP服务器；")]),s._v(" "),t("li",[s._v("绑定到LDAP服务器；")]),s._v(" "),t("li",[s._v("在LDAP服务器上执行所需的任何操作；")]),s._v(" "),t("li",[s._v("释放LDAP服务器的连接；")])]),s._v(" "),t("h2",{attrs:{id:"_2-openldap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-openldap"}},[s._v("#")]),s._v(" 2. "),t("strong",[s._v("openldap")])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("openldap官网")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://wiki.shileizcc.com/confluence/display/openldap/Docker+OpenLDAP",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker OpenLDAP"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[s._v("django实现登录流程对应的代码")]),s._v(" "),t("p",[s._v("["),t("a",{attrs:{href:"https://www.cnblogs.com/caseast/p/6090759.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("原创]django+ldap实现统一认证部分二(python-ldap实践)"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[s._v("linux部署openldap详细")])])]),s._v(" "),t("h3",{attrs:{id:"_2-1-openldap目录架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-openldap目录架构"}},[s._v("#")]),s._v(" 2.1 "),t("strong",[s._v("OpenLDAP目录架构")])]),s._v(" "),t("h4",{attrs:{id:"_1-openldap目录架构介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-openldap目录架构介绍"}},[s._v("#")]),s._v(" 1. "),t("strong",[s._v("OpenLDAP目录架构介绍")])]),s._v(" "),t("p",[s._v("目前OpenLDAP目录架构分为两种：一种为互联网命名组织架构；另一种为企业级命名组织架构。本节分别为介绍两种架构的用途，但本书主要以企业级命名组织架构为核心进行阐述OpenLDAP内部逻辑结构、工作原理以及企业实践等相关知识。")]),s._v(" "),t("h4",{attrs:{id:"_2-互联网命名组织架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-互联网命名组织架构"}},[s._v("#")]),s._v(" 2. "),t("strong",[s._v("互联网命名组织架构")])]),s._v(" "),t("p",[s._v("LDAP的目录信息是以树形结构进行存储的，在树根一般定义国家（c=CN）或者域名（dc=com），其次往往定义一个或多个组织（organization，o）或组织单元（organization unit，ou）。一个组织单元可以包含员工、设备信息（计算机/打印机等）相关信息。例如uid=babs，ou=People，dc=example，dc=com，如图1-2所示。")]),s._v(" "),t("p",[t("img",{attrs:{src:a(371),alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_3-企业级命名组织架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-企业级命名组织架构"}},[s._v("#")]),s._v(" 3. "),t("strong",[s._v("企业级命名组织架构")])]),s._v(" "),t("p",[s._v("企业级命名组织架构的示例如图1-3所示。")]),s._v(" "),t("p",[t("img",{attrs:{src:a(372),alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_4-openldap的系统架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-openldap的系统架构"}},[s._v("#")]),s._v(" 4. "),t("strong",[s._v("OpenLDAP的系统架构")])]),s._v(" "),t("p",[s._v("OpenLDAP目前是一款开源账号集中管理软件，且属于C/S架构（见图1-4）。通过配置服务器和客户端，实现账号的管理，并通过与第三方应用相结合，实现客户端所有账号均可通过服务端进行验证，例如Samba、Apache、Zabbix、FTP、Postfix、EMC存储以及系统登录验证并授权。")]),s._v(" "),t("p",[t("img",{attrs:{src:a(373),alt:""}})]),s._v(" "),t("h4",{attrs:{id:"_5-openldap的工作模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-openldap的工作模型"}},[s._v("#")]),s._v(" 5. "),t("strong",[s._v("OpenLDAP的工作模型")])]),s._v(" "),t("p",[s._v("OpenLDAP的工作模型如图1-5所示。")]),s._v(" "),t("p",[t("img",{attrs:{src:a(374),alt:""}})]),s._v(" "),t("p",[s._v("OpenLDAP工作模型解释如下：")]),s._v(" "),t("p",[s._v("客户端向OpenLDAP服务器发起验证请求；服务器接收用户请求后，并通过slapd进程向后端的数据库进行查询；slapd将查询的结果返回给客户端即可。如果有缓存机制，服务器端会先将查询的条目进行缓存，然后再发给客户端。")]),s._v(" "),t("h2",{attrs:{id:"_3-如何使用python连接ldap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-如何使用python连接ldap"}},[s._v("#")]),s._v(" 3. "),t("strong",[s._v("如何使用Python连接ldap")])]),s._v(" "),t("p",[s._v("https://www.cnblogs.com/linxiyue/p/10250243.html")]),s._v(" "),t("p",[s._v("好多使用ldap认证的软件都是Python的，比如superset和airflow， 好吧，他们都是airbnb家的。在配置ldap的时候可能会出现认证失败，你不知道是因为什么导致配置失败的。所以，就要跟踪源码，看看内部怎么认证实现的。")]),s._v(" "),t("p",[s._v("ldap介绍和使用安装参见： https://www.cnblogs.com/woshimrf/p/ldap.html")]),s._v(" "),t("p",[s._v("登录的源码参见： https://github.com/apache/airflow/blob/70e937a8d8ff308a9fb9055ceb7ef2c034200b36/airflow/contrib/auth/backends/ldap_auth.py#L191")]),s._v(" "),t("p",[s._v("具体来实现如下：")]),s._v(" "),t("p",[s._v("为了模拟环境，我们使用docker-python。基于Debian Python3: https://github.com/Ryan-Miao/docker-china-source/tree/master/docker-python")]),s._v(" "),t("p",[s._v("启动")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker run -it ryan/python:3 /bin/bash\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("下载ldap3")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pip install ldap3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("LDAP(Light Directory Access Portocol)是轻量目录访问协议，基于X.500标准，支持TCP/IP。")]),s._v(" "),t("p",[s._v("LDAP目录以树状的层次结构来存储数据。每个目录记录都有标识名（Distinguished Name，简称DN），用来读取单个记录，一般是这样的：")]),s._v(" "),t("p",[s._v("几个关键字的含义如下：")]),s._v(" "),t("ul",[t("li",[s._v("base dn：LDAP目录树的最顶部，也就是树的根，是上面的dc=test,dc=com部分，一般使用公司的域名，"),t("a",{attrs:{href:"http://%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%86%99%E5%81%9Ao=test.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("也可以写做o=test.com"),t("OutboundLink")],1),s._v("，前者更灵活一些。")]),s._v(" "),t("li",[s._v("dc:：Domain Component，域名部分。")]),s._v(" "),t("li",[s._v("ou：Organization Unit，组织单位，用于将数据区分开。")]),s._v(" "),t("li",[s._v("cn：Common Name，一般使用用户名。")]),s._v(" "),t("li",[s._v("uid：用户id，与cn的作用类似。")]),s._v(" "),t("li",[s._v("sn：Surname， 姓。")]),s._v(" "),t("li",[s._v("rdn：Relative dn，dn中与目录树的结构无关的部分，通常存在cn或者uid这个属性里。")])]),s._v(" "),t("p",[s._v("所以上面的dn代表一条记录，代表一位在test.com公司people部门的用户username。")]),s._v(" "),t("h3",{attrs:{id:"python-ldap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#python-ldap"}},[s._v("#")]),s._v(" "),t("strong",[s._v("python-ldap")])]),s._v(" "),t("p",[s._v("python一般使用python-ldap库操作ldap，文档：https://www.python-ldap.org/en/latest/index.html。")]),s._v(" "),t("p",[s._v("下载：")]),s._v(" "),t("p",[s._v("还要安装一些环境，ubuntu：")]),s._v(" "),t("p",[s._v("CentOS：")]),s._v(" "),t("p",[s._v("获取LDAP地址后即可与LDAP建立连接：")]),s._v(" "),t("p",[s._v("绑定用户，可用于用户验证，用户名必须是dn：")]),s._v(" "),t("p",[s._v("成功认证时会返回一个tuple:")]),s._v(" "),t("p",[s._v("验证失败会报异常ldap.INVALID_CREDENTIALS：")]),s._v(" "),t("p",[s._v("注意验证时传空值验证也是可以通过的，注意要对dn和pwd进行检查。")]),s._v(" "),t("p",[s._v("查询LDAP用户信息时，需要登录管理员RootDN帐号：")]),s._v(" "),t("p",[s._v("添加用户add_s(dn, modlist)，dn为要添加的条目dn，modlist为存储信息：")]),s._v(" "),t("p",[s._v("添加成功会返回元组：")]),s._v(" "),t("p",[s._v("失败会报ldap.LDAPError异常")]),s._v(" "),t("h2",{attrs:{id:"_4-django使用ldap验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-django使用ldap验证"}},[s._v("#")]),s._v(" 4. "),t("strong",[s._v("Django使用LDAP验证")])]),s._v(" "),t("p",[s._v("参考文章")]),s._v(" "),t("p",[s._v("["),t("a",{attrs:{href:"https://www.bbsmax.com/R/Vx5MxPmJNr/",target:"_blank",rel:"noopener noreferrer"}},[s._v("原创]django+ldap实现统一认证部分一(django-auth-ldap实践) - 相关文章"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("strong",[s._v("简要流程")])]),s._v(" "),t("p",[s._v("登录时，在默认的django"),t("a",{attrs:{href:"https://cloud.tencent.com/solution/database?from=10680",target:"_blank",rel:"noopener noreferrer"}},[s._v("数据库"),t("OutboundLink")],1),s._v("帐号验证之前，会先到LDAP服务器上去验证。 输入的登录帐号到LDAP服务器验证之前，会先用配置文件中的绑定DN、密码去验证，验证通过才能继续用输入的帐号密码去LDAP服务器验证。 若LDAP验证通过，会检查django数据库中是否已存在该帐号，若不存在，则会根据LDAP验证通过后获取的用户信息，来创建django数据库的用户账号。帐号名和输入的一样，密码则会设为一个无效的密码（看了下源码是”!”,无法合法哈希编码），因为该帐号密码验证是从LDAP上进行，所以django中的密码不会被使用到。除了默认的用户姓名、邮件等信息，若要把Group信息也同步过来的话需要进行相应的配置。 若LDAP验证失败，则会使用Django数据库的默认登录验证。")]),s._v(" "),t("p",[t("strong",[s._v("ldap认证实现思路")])]),s._v(" "),t("p",[s._v("如果一个项目的用户登陆要通过ldap，那么这个项目一般就是公司内部项目，例如OA系统，运维平台等。那么，我们可以将用户输入账号、密码信息发给ldap服务器进行认证。如果ldap认证通过，我们去查询数据库中是否已存在此账号的用户，若存在，直接跳转登陆即可，若不存在，则先在数据库中创建此用户，随后跳转登陆。如果ldap认证失败，提示错误信息并返回登陆页即可。有了这样的思路，我们的代码就很简单了。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://django-auth-ldap.readthedocs.io/en/latest/authentication.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Authentication - django-auth-ldap 4.1.1.dev6+ga6e03c6.d20220907 documentation"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("Django集成LDAP认证有现成的"),t("code",[s._v("django-auth-ldap")]),s._v("模块可以使用，本文也主要以这个模块的使用为主，先安装模块")]),s._v(" "),t("ol",[t("li",[s._v("LDAP中存用户的DN值（distinguished name即唯一值），DN值目测有3种方式组成：")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("LDAP中存用户的DN值（distinguished name即唯一值），DN值目测有"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("种方式组成：\na"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("用户名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ou"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("LDAP组"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("域名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com或者cn，举例 uid"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ou"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eoncloud"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com\nb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("用户名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ou"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("LDAP组"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("域名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com或者cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 举例cn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ou"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eoncloud"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com\nc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" sAMAccountName"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("用户"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ou"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("LDAP组"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("域名"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com或者cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" sAMAccountName要结合AD域用，我司LDAP没用AD域，此处忽略\n与LDAP管理员确认我司用uid方式生成DN值，那么django配置文件里面相应的配置项就用uid\n为什么要分清楚DN呢，是因为任何系统登录时会录入username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("password，而username就是用来组成DN的；应用系统生成DN（含username）值"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("password发到LDAP去匹配，匹配上了LDAP会返回给应用经过鉴权的用户信息，进而登录到应用系统中；当然，此username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("password事先已经存在于LDAP中的，鉴权成功的服务端日志打印如下：\nCreated Django user xxxx\nPopulating Django user xxxx\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Nov"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2017")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST /accounts/login/ HTTP/1.1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"_4-1-django中ldap验证的三种方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-django中ldap验证的三种方式"}},[s._v("#")]),s._v(" 4.1 django中ldap验证的三种方式")]),s._v(" "),t("h5",{attrs:{id:"方法一-settings"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法一-settings"}},[s._v("#")]),s._v(" "),t("strong",[s._v("方法一：settings")])]),s._v(" "),t("p",[t("strong",[s._v("django中settings添加ldap验证及自动记录用户信息到本地user表中")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# settings配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ldap\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django_auth_ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("config "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" LDAPSearch\n\nAUTHENTICATION_BACKENDS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置为先使用LDAP认证，如通过认证则不再使用后面的")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'django_auth_ldap.backend.LDAPBackend'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地用户验证，如果不需要的，可以注释掉")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'django.contrib.auth.backends.ModelBackend'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nbase_dn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dc=baidu,dc=com'")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ldap的域名信息（例如baidu.com，可以拆分为baidu跟com）")]),s._v("\nAUTH_LDAP_SERVER_URI "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ldap://xxx.xxx.xxx.xxx:389'")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ldap服务器地址及端口")]),s._v("\nAUTH_LDAP_BIND_DN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx@baidu.com'")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户名，可以使用自己的用户名,用户名后面要加上域名")]),s._v("\nAUTH_LDAP_BIND_PASSWORD "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),s._v("\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对应用户名的密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LDAPSearch参数1：搜索的用户信息，ou是组织，后面格式化输出的是你的用户名信息，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参数2：默认，参数3：搜索的用户，我使用的user，有的公司是uid，如果不知道，可以尝试下")]),s._v("\nAUTH_LDAP_USER_SEARCH "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LDAPSearch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ou=你的组织,%s'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" base_dn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SCOPE_SUBTREE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(SamAccountName=%(user)s)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\t\nAUTH_LDAP_ALWAYS_UPDATE_USER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# key为数据库字段名，value为ldap中字段名，此字典解决django model与ldap字段名可能出现的不一致问题")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例如：用户名，在自己django的user表中字段是username，但是在ldap中字段是sAMAccountName，利用此配置可以同步")]),s._v("\nAUTH_LDAP_USER_ATTR_MAP "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sAMAccountName"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"physicalDeliveryOfficeName"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mail"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'company'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'company'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'department'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'department'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("p",[s._v("用户登录的时候使用默认的认证类")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户登录view")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Response\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("views "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" APIView\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("contrib"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" authenticate\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Login")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("APIView"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先验证ldap账户，如果不存在，则会验证本地用户")]),s._v("\n        ldap_user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" authenticate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证通过后，可以看到，本地user表中，会自动添加一条同步的用户信息")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ldap_user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'code'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'uid'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ldap_user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ldap_user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'department'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ldap_user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("department"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'code'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("405")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'message'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户名或密码错误'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h5",{attrs:{id:"方法二-ldap3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法二-ldap3"}},[s._v("#")]),s._v(" "),t("strong",[s._v("方法二：ldap3")])]),s._v(" "),t("p",[t("strong",[s._v("这是一种更加简单的，适用与验证该用户是否存在的ldap认证方式,通过用户输入的信息直接连接ldap去当中获取，获取成功则登录成功。")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" ldap3 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ALL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NTLM\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("new_auth_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 链接服务，参数一：服务器ip")]),s._v("\n    server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx.xxx.xxx.xxx'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" get_info"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ALL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user中要拼接用户的域，例如，域名是baidu.com，则可以修改为：'baidu\\\\\\\\' + username")]),s._v("\n    conn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'baidu\\\\\\\\'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" auto_bind"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" authentication"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NTLM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置搜索的组织及域名,例如域名为baidu.com，则可以如下配置。第二个参数，需要搜索的用户名，")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第三个参数，搜索用户的信息，*代表所搜该用户的所有信息，可以根据需要进行修改，必定很多信息我们用不到")]),s._v("\n    conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("search"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ou=你的组织,dc=baidu,dc=com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(SamAccountName=搜索的用户名)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" attributes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    result "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("entrie\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("result"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h5",{attrs:{id:"方法三-ldap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法三-ldap"}},[s._v("#")]),s._v(" "),t("strong",[s._v("方法三：ldap")])]),s._v(" "),t("p",[t("strong",[s._v("此方法只能认证用户是否存在")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ldap\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("auth_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    conn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initialize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ldap服务器地址"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx.xxx.xxx.xxx:389'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将username附加上域名")]),s._v("\n        username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@xxxxx.com'")]),s._v("\n    \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 验证用户是否存在，存在返回1，不存在，则会报错")]),s._v("\n        conn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("simple_bind_s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" Exception "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" e\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"基于现在登录操作实现思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基于现在登录操作实现思路"}},[s._v("#")]),s._v(" 基于现在登录操作实现思路")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 用户调用登录接口，输入（用户名或邮箱、密码） cabits中"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("和username是唯一的。可以将"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("和username存入域中\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 通过ldap3模块连接到openldap服务\n\tserver "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ldaps://10.1.1.100'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" get_info"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ALL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" use_ssl"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 通过用户输入的信息，连接服务器，拼接域进行提取信息\n    c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" auto_bind"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qytang\\\\\\\\"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("ad_admin_username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ad_admin_password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接服务器")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 提取域qytang.com, 用户的memberOf,sn和department信息")]),s._v("\n    c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("search"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("search_base"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dc=qytang,dc=com'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" search_filter"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(&(samAccountName='")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'))'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" attributes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sn'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'department'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'createTimeStamp'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'accountExpires'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'userAccountControl'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'objectClass'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pwdLastSet'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" paged_size"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1")]),s._v(" 在域中提取信息成功，则返回对应的信息（username等一些属性信息）\n\t\ta"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 用户username或者"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("等一些唯一的信息。在获取一次本地的数据库 使用create_or_update方法看是否有修改的。获取到对象信息生成token并返回\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v(" 在域中没有找到\n\t  a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 用户用户输入的信息去本地的数据中查找，本地的数据中查找到，则向服务中添加一个用户域\n\t\t\tc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" auto_bind"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"qytang\\\\\\\\"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("ad_admin_username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ad_admin_password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user_dn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" attributes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'objectClass'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'top'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'person'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'organizationalPerson'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sAMAccountName'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" add_username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n需要在域中绑定"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v(" 还是 绑定username password\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h3",{attrs:{id:"_4-2-django配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-django配置"}},[s._v("#")]),s._v(" 4.2 django配置")]),s._v(" "),t("h4",{attrs:{id:"_1-安装依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装依赖"}},[s._v("#")]),s._v(" 1. 安装依赖")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("pip install python"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ldap  django"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ldap\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_2-配置django的settings-py文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置django的settings-py文件"}},[s._v("#")]),s._v(" 2. 配置django的settings.py文件")]),s._v(" "),t("p",[s._v("加入 "),t("code",[s._v("django_python3_ldap")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("INSTALLED_APPS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'django_python3_ldap'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Django-auth-ldap 配置部分")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ldap\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django_auth_ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("config "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" LDAPSearch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("GroupOfNamesType\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改Django认证先走ldap，再走本地认证")]),s._v("\nAUTHENTICATION_BACKENDS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'django_auth_ldap.backend.LDAPBackend'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'django.contrib.auth.backends.ModelBackend'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ldap的连接基础配置")]),s._v("\nAUTH_LDAP_SERVER_URI "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ldap://xxx.xxx.xxx.xxx:389"')]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ldap or ad 服务器地址AUTH_LDAP_BIND_DN = \"CN=administrator,CN=Users,DC=test,DC=com\" # 管理员的dn路径AUTH_LDAP_BIND_PASSWORD = 'testpassword' # 管理员密码#允许认证用户的路径")]),s._v("\nAUTH_LDAP_USER_SEARCH "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LDAPSearch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OU=test,DC=test,DC=intra"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SCOPE_SUBTREE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(sAMAccountName=%(user)s)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一个参数是搜索的范围")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过组进行权限控制")]),s._v("\nAUTH_LDAP_GROUP_SEARCH "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LDAPSearch"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ou=groups,ou=test,dc=test,dc=intra"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SCOPE_SUBTREE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(objectClass=groupOfNames)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nAUTH_LDAP_GROUP_TYPE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GroupOfNamesType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#is_staff:这个组里的成员可以登录；is_superuser:组成员是django admin的超级管理员；is_active:组成员可以登录django admin后台，但是无权限查看后台内容")]),s._v("\nAUTH_LDAP_USER_FLAGS_BY_GROUP "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"is_staff"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=test_users,ou=groups,OU=test,DC=test,DC=com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"is_superuser"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=test_users,ou=groups,OU=tset,DC=test,DC=com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过组进行权限控制end")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果ldap服务器是Windows的AD，需要配置上如下选项")]),s._v("\nAUTH_LDAP_CONNECTION_OPTIONS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OPT_DEBUG_LEVEL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("OPT_REFERRALS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# key为数据库字段名，value为ldap中字段名，此字典解决django model与ldap字段名可能出现的不一致问题")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例如：用户名，在自己django的user表中字段是username，但是在ldap中字段是sAMAccountName，利用此配置可以同步")]),s._v("\nAUTH_LDAP_USER_ATTR_MAP "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sAMAccountName"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"physicalDeliveryOfficeName"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mail"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'company'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'company'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'department'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'department'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果为True，每次组成员都从ldap重新获取，保证组成员的实时性；反之会对组成员进行缓存，提升性能，但是降低实时性# AUTH_LDAP_FIND_GROUP_PERMS = True")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br")])]),t("h2",{attrs:{id:"一个很简单的ldap验证backend"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一个很简单的ldap验证backend"}},[s._v("#")]),s._v(" 一个很简单的LDAP验证Backend：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ldap\n \n \n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LDAPBackend")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n    Authenticates with ldap.\n    """')]),s._v("\n    _connection "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n    _connection_bound "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" username "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" passwd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_authenticate_user_dn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_get_or_create_user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" user\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@property")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("connection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_connection_bound"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_bind"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_get_connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("_bind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_bind_as"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            LDAP_CONFIG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'USERNAME'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LDAP_CONFIG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PASSWORD'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("_bind_as")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bind_dn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bind_password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sticky"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_get_connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("simple_bind_s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            bind_dn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" bind_password\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_connection_bound "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sticky\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("_get_connection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_connection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_connection "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initialize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LDAP_CONFIG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HOST'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_connection\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("_authenticate_user_dn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        bind_dn "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cn=%s,%s'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LDAP_CONFIG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BASE_DN'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_bind_as"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bind_dn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" ldap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("INVALID_CREDENTIALS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("\n \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("_get_or_create_user")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" username"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取或者新建User")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" user\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br")])]),t("p",[s._v("不想自己写的话，django与flask都有现成的库：")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/django-ldapdb/django-ldapdb",target:"_blank",rel:"noopener noreferrer"}},[s._v("django-ldap"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/admiralobvious/flask-simpleldap",target:"_blank",rel:"noopener noreferrer"}},[s._v("flask-ldap"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("账号管理\ncn"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("hongpu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("dc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com\nhongpu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("https://blog.csdn.net/u011607971/article/details/117824558")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker run p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("389")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("389")]),s._v(" p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("636")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("636")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name youe_ldap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("network bridge "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hostname openldap"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("host "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("env LDAP_ORGANISATION"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"youedata"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("env LDAP_DOMAIN"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"youedata.com"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("env LDAP_ADMIN_PASSWORD"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"youedata520"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("detach osixia"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("openldap\n————————————————\n版权声明：本文为CSDN博主「李小虾」的原创文章，遵循CC "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.0")]),s._v(" BY"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("SA版权协议，转载请附上原文出处链接及本声明。\n原文链接："),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("blog"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csdn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("net"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("monkeyblog"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("article"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("details"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("94021802")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/weixin_42257195/article/details/102769495",target:"_blank",rel:"noopener noreferrer"}},[s._v("LDAP使用docker安装部署与使用_啧啧zzz的博客-CSDN博客"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v('docker run -p 389:389 -p 636:636 --name your_ldap --network bridge --hostname openldap-host --env LDAP_ORGANISATION="example" --env LDAP_DOMAIN="'),t("a",{attrs:{href:"http://example.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("example.com"),t("OutboundLink")],1),s._v('" --env LDAP_ADMIN_PASSWORD="123456" --detach osixia/openldap')]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("privileged "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name youe_pla "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("env PHPLDAPADMIN_HTTPS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("env PHPLDAPADMIN_LDAP_HOSTS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("detach osixia"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("phpldapadmin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"slappasswd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#slappasswd"}},[s._v("#")]),s._v(" slappasswd")]),s._v(" "),t("p",[s._v("New password: Re-enter new password: {SSHA}s6p0UB2LhW3rZrEm/z5vqUjmPD1AadUR")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("env  PHPLDAPADMIN_HTTPS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false PHPLDAPADMIN_LDAP_HOSTS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("itd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("name phpldapadmin osixia"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("phpldapadmin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.9")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v('ldapadd -x -D "cn=admin,dc=example,dc=com" -W -f root.ldif')]),s._v(" "),t("h4",{attrs:{id:"添加ldif文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加ldif文件"}},[s._v("#")]),s._v(" 添加ldif文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("www"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jianshu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("p"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cce418c6a745"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("为解决问题")]),s._v(" "),t("p",[t("img",{attrs:{src:a(375),alt:""}})])])}),[],!1,null,null,null);t.default=e.exports}}]);