(window.webpackJsonp=window.webpackJsonp||[]).push([[232],{989:function(n,s,a){"use strict";a.r(s);var t=a(4),e=Object(t.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h1",{attrs:{id:"_2-宕机-panic-程序终止运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-宕机-panic-程序终止运行"}},[n._v("#")]),n._v(" 2. "),s("strong",[n._v("宕机（panic）——程序终止运行")])]),n._v(" "),s("p",[s("a",{attrs:{href:"https://golang-china.github.io/gopl-zh/ch5/ch5-09.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("Go语言圣经"),s("OutboundLink")],1)]),n._v(" "),s("h2",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[n._v("#")]),n._v(" 介绍")]),n._v(" "),s("p",[n._v("Go语言的类型系统会在编译时捕获很多错误，但有些错误只能在运行时检查，如数组访问越界、空指针引用等，这些运行时错误会引起宕机。")]),n._v(" "),s("p",[n._v("宕机不是一件很好的事情，可能造成体验停止、服务中断，就像没有人希望在取钱时遇到 ATM 机蓝屏一样，但是，如果在损失发生时，程序没有因为宕机而停止，那么用户将会付出更大的代价，这种代价可以是金钱、时间甚至生命，因此，宕机有时也是一种合理的止损方法。")]),n._v(" "),s("p",[n._v("一般而言，当宕机发生时，程序会中断运行，并立即执行在该 goroutine（可以先理解成线程）中被延迟的函数（defer 机制），随后，程序崩溃并输出日志信息，日志信息包括 panic value 和函数调用的堆栈跟踪信息，panic value 通常是某种错误信息。")]),n._v(" "),s("p",[n._v("对于每个 goroutine，日志信息中都会有与之相对的，发生 panic 时的函数调用堆栈跟踪信息，通常，我们不需要再次运行程序去定位问题，日志信息已经提供了足够的诊断依据，因此，在我们填写问题报告时，一般会将宕机和日志信息一并记录。")]),n._v(" "),s("p",[n._v("虽然Go语言的 panic 机制类似于其他语言的异常，但 panic 的适用场景有一些不同，由于 panic 会引起程序的崩溃，因此 panic 一般用于严重错误，如程序内部的逻辑不一致。任何崩溃都表明了我们的代码中可能存在漏洞，所以对于大部分漏洞，我们应该使用Go语言提供的错误机制，而不是 panic。")]),n._v(" "),s("p",[n._v("内建的函数 panic() 就可以造成崩溃，panic() 的声明如下")]),n._v(" "),s("div",{staticClass:"language-Go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("func")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("panic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),n._v("v "),s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("interface")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("//panic() 的参数可以是任意类型的。")]),n._v("\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("h2",{attrs:{id:"手动触发宕机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动触发宕机"}},[n._v("#")]),n._v(" 手动触发宕机")]),n._v(" "),s("p",[n._v("Go语言可以在程序中手动触发宕机，让程序崩溃，这样开发者可以及时地发现错误，同时减少可能的损失。")]),n._v(" "),s("p",[n._v("Go语言程序在宕机时，会将堆栈和 goroutine 信息输出到控制台，所以宕机也可以方便地知晓发生错误的位置，那么我们要如何触发宕机呢，示例代码如下所示：")]),n._v(" "),s("div",{staticClass:"language-Go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("package")]),n._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("func")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("panic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[n._v('"xxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// 手动触发宕机")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("/*\n\tpanic: xxx\n\t\n\tgoroutine 1 [running]:\n\tmain.main()\n\t\t\tG:/GolangCode/my/golang-foundation/6. 异常处理/2. panic宕机.go:4 +0x27\n*/")]),n._v("\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br")])]),s("h2",{attrs:{id:"在宕机时触发延迟执行语句"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在宕机时触发延迟执行语句"}},[n._v("#")]),n._v(" "),s("strong",[n._v("在宕机时触发延迟执行语句")])]),n._v(" "),s("p",[s("strong",[n._v("当 panic() 触发的宕机发生时，panic() 后面的代码将不会被运行，但是在 panic() 函数前面已经运行过的 defer 语句依然会在宕机发生时发生作用")])]),n._v(" "),s("div",{staticClass:"language-Go line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("package")]),n._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("import")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[n._v('"fmt"')]),n._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("func")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("{")]),n._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("defer")]),n._v(" fmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("Println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[n._v('"宕机后要做的事情1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[n._v("defer")]),n._v(" fmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("Println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[n._v('"宕机后要做的事情2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[n._v("panic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[n._v('"触发宕机"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v(")")]),n._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// 手动触发宕机")]),n._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("// 当 panic() 触发的宕机发生时，panic() 后面的代码将不会被运行，但是在 panic() 函数前面已经运行过的 defer 语句依然会在宕机发生时发生作用")]),n._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[n._v("}")]),n._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[n._v("/*\n\t宕机后要做的事情2\n\t宕机后要做的事情1\n\tpanic: 触发宕机\n\n\tgoroutine 1 [running]:\n\tmain.main()\n\t\t\tG:/GolangCode/my/golang-foundation/6. 异常处理/2. panic宕机.go:8 +0xac\n*/")]),n._v("\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);