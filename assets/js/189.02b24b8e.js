(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{918:function(s,a,e){"use strict";e.r(a);var n=e(4),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("默认情况下，Django 使用 "),a("code",[s._v("MEDIA_ROOT")]),s._v(" 和"),a("code",[s._v("MEDIA_URL")]),s._v(" 设置本地存储。下面的例子假设你在使用这些默认设置。")]),s._v(" "),a("h2",{attrs:{id:"_1、在模型中使用文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、在模型中使用文件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("1、在模型中使用文件")])]),s._v(" "),a("p",[s._v("当你使用 "),a("code",[s._v("FileField")]),s._v(") 或 "),a("code",[s._v("ImageField")]),s._v(" 时，Django 提供了一组处理文件的API。")]),s._v(" "),a("p",[s._v("考虑下面的模型，使用 ImageField 来存储照片：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from django.db import models\n\nclass Car(models.Model):\n    price = models.DecimalField(max_digits=5, decimal_places=2)\n    photo = models.ImageField(upload_to='cars') # 路径名字\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("任何 "),a("code",[s._v("Car")]),s._v(" 实例将拥有一个 "),a("code",[s._v("photo")]),s._v(" 属性，你可以使用它来获取附加照片的详情：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(">>> car = Car.objects.get(pk=id)\n>>> car.photo\n<ImageFieldFile: cars/test.jpg>\n>>> car.photo.name\n'cars/test.jpg'\n>>> car.photo.path\n'/media/cars/test.jpg'\n>>> car.photo.url\n'<http://media.example.com/cars/test.jpg>'\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("code",[s._v("car.photo")]),s._v(" 是一个 "),a("code",[s._v("File")]),s._v(" 对象，这意味着它拥有下面所描述的所有方法和属性。")]),s._v(" "),a("p",[a("strong",[s._v("注意")])]),s._v(" "),a("p",[s._v("文件在数据库中作为保存模型的一部分，因此在模型被保存之前，不能依赖磁盘上使用的实际文件名。")]),s._v(" "),a("h2",{attrs:{id:"_2、file-对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、file-对象"}},[s._v("#")]),s._v(" "),a("strong",[s._v("2、File 对象")])]),s._v(" "),a("p",[s._v("在内部，Django 在任何需要表示文件的时候使用 "),a("code",[s._v("django.core.files.File")])]),s._v(" "),a("p",[s._v("大部分情况下你只需要使用 Django 提供的 "),a("code",[s._v("File")]),s._v(" （即附加到上述模型的文件或已经上传的文件）。")]),s._v(" "),a("p",[s._v("如果你需要自己构建 "),a("code",[s._v("File")]),s._v(" ，最简单的方法是使用 Python 内置的 "),a("code",[s._v("file")]),s._v(" 对象创建一个：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(">>> from django.core.files import File\n\n>>> f = open('/path/to/hello.txt', 'w')\n>>> myfile = File(f)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("现在你可以使用 "),a("code",[s._v("File")]),s._v(" 类的任何属性和方法。")]),s._v(" "),a("p",[s._v("注意在这里创建的文件不会自动关闭。下面的方式可以用来自动关闭文件：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(">>> from django.core.files import File\n\n>>> with open('/path/to/hello.world', 'w') as f:\n...     myfile = File(f)\n...     myfile.write('Hello World')\n...\n>>> myfile.closed\nTrue\n>>> f.closed\nTrue\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("在对大量对象进行循环访问文件字段时，关闭文件尤为重要。如果文件在访问后不能手动关闭，可能会出现文件描述符溢出的风险。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("OSError: [Errno 24] Too many open files\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_3、文件存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、文件存储"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3、文件存储")])]),s._v(" "),a("p",[s._v("在后台，Django将如何以及在哪里存储文件的决策委托给文件存储系统。这个对象实际上理解文件系统、打开和读取文件等。")]),s._v(" "),a("p",[s._v("Django 的默认文件存储通过 "),a("code",[s._v("DEFAULT_FILE_STORAGE")]),s._v(") 配置；如果你不显式地提供存储系统，这里会使用默认配置。")]),s._v(" "),a("h3",{attrs:{id:"_3-1-存储对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-存储对象"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.1 存储对象")])]),s._v(" "),a("p",[s._v("虽然大部分时间你可以使用 "),a("code",[s._v("File")]),s._v(" 对象（将该文件委托给合适的存储），但你可以直接使用文件存储系统。你可以创建一些自定义文件存储类的示例，或使用通常更有用的全局默认存储系统：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(">>> from django.core.files.base import ContentFile\n>>> from django.core.files.storage import default_storage\n\n>>> path = default_storage.save('path/to/file', ContentFile(b'new content'))\n>>> path\n'path/to/file'\n\n>>> default_storage.size(path)\n11\n>>> default_storage.open(path).read()\nb'new content'\n\n>>> default_storage.delete(path)\n>>> default_storage.exists(path)\nFalse\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_3-2-内置文件存储类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-内置文件存储类"}},[s._v("#")]),s._v(" "),a("strong",[s._v("3.2 内置文件存储类")])]),s._v(" "),a("p",[s._v("Django 附带一个 "),a("code",[s._v("django.core.files.storage.FileSystemStorage")]),s._v(" 类，这个类实现基础的本地文件系统文件存储。")]),s._v(" "),a("p",[s._v("例如，下面的代码将存储上传文件到 "),a("code",[s._v("/media/photos")]),s._v(" 而会忽略你在 "),a("code",[s._v("MEDIA_ROOT")]),s._v(" 的设置：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from django.core.files.storage import FileSystemStorage\nfrom django.db import models\n\nfs = FileSystemStorage(location='/media/photos')\n\nclass Car(models.Model):\n    ...\n    photo = models.ImageField(storage=fs)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("1")])])}),[],!1,null,null,null);a.default=t.exports}}]);