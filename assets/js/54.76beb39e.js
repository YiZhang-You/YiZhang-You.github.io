(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{1038:function(n,s,t){"use strict";t.r(s);var a=t(4),e=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h1",{attrs:{id:"cld模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cld模式"}},[n._v("#")]),n._v(" CLD模式")]),n._v(" "),s("h2",{attrs:{id:"链接资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#链接资料"}},[n._v("#")]),n._v(" 链接资料")]),n._v(" "),s("ol",[s("li",[n._v("博客")])]),n._v(" "),s("p",[s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_6-3-%E4%BD%BF%E7%94%A8golang-ide%E5%90%AF%E5%8A%A8",target:"_blank",rel:"noopener noreferrer"}},[n._v("08.web脚手架 | 不做大哥好多年"),s("OutboundLink")],1)]),n._v(" "),s("h3",{attrs:{id:"_00-项目结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_00-项目结构"}},[n._v("#")]),n._v(" "),s("strong",[n._v("00.项目结构")])]),n._v(" "),s("h4",{attrs:{id:"_0-1-新建项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-1-新建项目"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_0-1-%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("0.1 新建项目")])]),n._v(" "),s("p",[s("img",{attrs:{src:t(689),alt:""}})]),n._v(" "),s("h4",{attrs:{id:"_0-2-项目结构图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-2-项目结构图"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_0-2-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E5%9B%BE",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("0.2 项目结构图")])]),n._v(" "),s("p",[s("code",[n._v("CLD + 模型")])]),n._v(" "),s("ul",[s("li",[s("p",[n._v("controller")])]),n._v(" "),s("li",[s("p",[n._v("logic")])]),n._v(" "),s("li",[s("p",[n._v("dao")])]),n._v(" "),s("li",[s("p",[n._v("models")])])]),n._v(" "),s("p",[s("code",[n._v("日志、路由、三方库")])]),n._v(" "),s("ul",[s("li",[s("p",[n._v("logger")])]),n._v(" "),s("li",[s("p",[n._v("routes")])]),n._v(" "),s("li",[s("p",[n._v("pkg")])])]),n._v(" "),s("p",[s("code",[n._v("main.go、配置文件")])]),n._v(" "),s("ul",[s("li",[s("p",[n._v("main.go")])]),n._v(" "),s("li",[s("p",[n._v("conf")])]),n._v(" "),s("li",[s("p",[n._v("settings")])])]),n._v(" "),s("p",[s("img",{attrs:{src:t(690),alt:""}})]),n._v(" "),s("h4",{attrs:{id:"_0-3-初始化main-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-3-初始化main-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_0-3-%E5%88%9D%E5%A7%8B%E5%8C%96main-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("0.3 初始化main.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v("func main() {\n\t// 1. 加载配置（viper配置管理）\n\n\t// 2. 初始化日志（zap日志库）\n\n\t// 3. 初始化MySQL连接（sqlx）\n\n\t// 4. 初始化Redis连接（go-redis）\n\n\t// 5. 注册路由\n\n\t// 6. 启动服务（优雅关机）\n\n}\n\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br")])]),s("p",[n._v("1234567891011121314")]),n._v(" "),s("h3",{attrs:{id:"_01-第一-加载配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_01-第一-加载配置"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_01-%E7%AC%AC%E4%B8%80-%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("01.第一: 加载配置")])]),n._v(" "),s("h4",{attrs:{id:"_1-1-config-yaml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-config-yaml"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_1-1-config-yaml",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("1.1 config.yaml")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('name: "web_app"\nmode: "dev"\nport: 8080\nversion: "v0.1.4"\n\n# 雪花算法：开始时间 机器ID\nstart_time: "2020-07-01"\nmachine_id: 1\n\nlog:\n  level: "debug"\n  filename: "web_app.log"\n  max_size: 200\n  max_age: 30\n  max_backups: 7\nmysql:\n  host: "127.0.0.1"\n  port: 3306\n  user: "root"\n  password: "chnsys@2016"\n  dbname: "gin_bbs"\n  max_open_conns: 200\n  max_idle_conns: 50\nredis:\n  host: "127.0.0.1"\n  port: 6379\n  password: ""\n  db: 0\n  pool_size: 100\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br")])]),s("p",[n._v("1234567891011121314151617181920212223242526272829")]),n._v(" "),s("h4",{attrs:{id:"_1-2-settings-settings-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-settings-settings-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_1-2-settings-settings-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("1.2 settings/settings.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package settings\n\nimport (\n\t"fmt"\n\t"github.com/fsnotify/fsnotify"\n\t"github.com/spf13/viper"\n)\n\n// Conf 全局变量，用来保存程序的所有配置信息\nvar Conf = new(AppConfig)\n\ntype AppConfig struct {\n\tName         string `mapstructure:"name"`\n\tMode         string `mapstructure:"mode"`\n\tVersion      string `mapstructure:"version"`\n\tPort         int    `mapstructure:"port"`\n\tStartTime    string `mapstructure:"start_time"`\n\tMachineID    int64  `mapstructure:"machine_id"`\n\t*LogConfig   `mapstructure:"log"`\n\t*MySQLConfig `mapstructure:"mysql"`\n\t*RedisConfig `mapstructure:"redis"`\n}\n\ntype LogConfig struct {\n\tLevel      string `mapstructure:"level"`\n\tFilename   string `mapstructure:"filename"`\n\tMaxSize    int    `mapstructure:"max_size"`\n\tMaxAge     int    `mapstructure:"max_age"`\n\tMaxBackups int    `mapstructure:"max_backups"`\n}\n\ntype MySQLConfig struct {\n\tHost         string `mapstructure:"host"`\n\tUser         string `mapstructure:"user"`\n\tPassword     string `mapstructure:"password"`\n\tDbName       string `mapstructure:"dbname"`\n\tPort         int    `mapstructure:"port"`\n\tMaxOpenConns int    `mapstructure:"max_open_conns"`\n\tMaxIdleConns int    `mapstructure:"max_idle_conns"`\n}\n\ntype RedisConfig struct {\n\tHost     string `mapstructure:"host"`\n\tPassword string `mapstructure:"password"`\n\tPort     int    `mapstructure:"port"`\n\tDB       int    `mapstructure:"db"`\n\tPoolSize int    `mapstructure:"pool_size"`\n}\n\nfunc Init() (err error) {\n\n\tviper.SetConfigFile("conf/config.yaml")\n\t//viper.SetConfigName("config") // 指定配置文件名称（不需要带后缀）\n\t//viper.SetConfigType("yaml")   // 指定配置文件类型(专用于从远程获取配置信息时指定配置文件类型的)\n\tviper.AddConfigPath(".")   // 指定查找配置文件的路径（这里使用相对路径）\n\terr = viper.ReadInConfig() // 读取配置信息\n\tif err != nil {\n\t\t// 读取配置信息失败\n\t\tfmt.Printf("viper.ReadInConfig() failed, err:%v\\n", err)\n\t\treturn\n\t}\n\t// 把读取到的配置信息反序列化到 Conf 变量中\n\tif err := viper.Unmarshal(Conf); err != nil {\n\t\tfmt.Printf("viper.Unmarshal failed, err:%v\\n", err)\n\t}\n\tviper.WatchConfig()\n\tviper.OnConfigChange(func(in fsnotify.Event) {\n\t\tfmt.Println("配置文件修改了，重新加载到全局Conf ...")\n\t\tif err := viper.Unmarshal(Conf); err != nil {\n\t\t\tfmt.Printf("viper.Unmarshal failed, err:%v\\n", err)\n\t\t}\n\t})\n\treturn\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br")])]),s("p",[n._v("1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374")]),n._v(" "),s("h4",{attrs:{id:"_1-3-main-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-main-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_1-3-main-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("1.3 main.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package main\n\nimport (\n\t"fmt"\n\t"my_web/settings"\n)\n\nfunc main() {\n\t// 1. 加载配置（viper配置管理）\n\tif err := settings.Init(); err != nil {\n\t\tfmt.Printf("init settings failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Println(settings.Conf)\n\tfmt.Println(settings.Conf.Name)  // web_app\n\tfmt.Println(settings.Conf.LogConfig == nil)\n\t// 2. 初始化日志（zap日志库）\n\n\t// 3. 初始化MySQL连接（sqlx）\n\n\t// 4. 初始化Redis连接（go-redis）\n\n\t// 5. 注册路由\n\n\t// 6. 启动服务（优雅关机）\n\n}\n\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br")])]),s("p",[n._v("12345678910111213141516171819202122232425262728")]),n._v(" "),s("h3",{attrs:{id:"_02-第二-初始化日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_02-第二-初始化日志"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_02-%E7%AC%AC%E4%BA%8C-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%A5%E5%BF%97",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("02.第二: 初始化日志")])]),n._v(" "),s("h4",{attrs:{id:"_2-1-logger-logger-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-logger-logger-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_2-1-logger-logger-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("2.1 logger/logger.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package logger\n\nimport (\n\t"github.com/gin-gonic/gin"\n\t"github.com/natefinch/lumberjack"\n\t"go.uber.org/zap"\n\t"go.uber.org/zap/zapcore"\n\t"net"\n\t"net/http"\n\t"net/http/httputil"\n\t"os"\n\t"runtime/debug"\n\t"strings"\n\t"time"\n\t"web_app/settings"\n)\n\nvar lg *zap.Logger\n\n// Init 初始化lg\nfunc Init(cfg *settings.LogConfig, mode string) (err error) {\n\twriteSyncer := getLogWriter(cfg.Filename, cfg.MaxSize, cfg.MaxBackups, cfg.MaxAge)\n\tencoder := getEncoder()\n\tvar l = new(zapcore.Level)\n\terr = l.UnmarshalText([]byte(cfg.Level))\n\tif err != nil {\n\t\treturn\n\t}\n\tvar core zapcore.Core\n\tif mode == "dev" {\n\t\t// 进入开发模式，日志输出到终端\n\t\tconsoleEncoder := zapcore.NewConsoleEncoder(zap.NewDevelopmentEncoderConfig())\n\t\tcore = zapcore.NewTee(\n\t\t\tzapcore.NewCore(encoder, writeSyncer, l),\n\t\t\tzapcore.NewCore(consoleEncoder, zapcore.Lock(os.Stdout), zapcore.DebugLevel),\n\t\t)\n\t} else {\n\t\t// 如果不是dev模式，就记录日志到日志文件中\n\t\tcore = zapcore.NewCore(encoder, writeSyncer, l)\n\t}\n\n\tlg = zap.New(core, zap.AddCaller())\n\n\tzap.ReplaceGlobals(lg)\n\tzap.L().Info("init logger success")\n\treturn\n}\n\nfunc getEncoder() zapcore.Encoder {\n\tencoderConfig := zap.NewProductionEncoderConfig()\n\tencoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder\n\tencoderConfig.TimeKey = "time"\n\tencoderConfig.EncodeLevel = zapcore.CapitalLevelEncoder\n\tencoderConfig.EncodeDuration = zapcore.SecondsDurationEncoder\n\tencoderConfig.EncodeCaller = zapcore.ShortCallerEncoder\n\treturn zapcore.NewJSONEncoder(encoderConfig)\n}\n\nfunc getLogWriter(filename string, maxSize, maxBackup, maxAge int) zapcore.WriteSyncer {\n\tlumberJackLogger := &lumberjack.Logger{\n\t\tFilename:   filename,\n\t\tMaxSize:    maxSize,\n\t\tMaxBackups: maxBackup,\n\t\tMaxAge:     maxAge,\n\t}\n\treturn zapcore.AddSync(lumberJackLogger)\n}\n\n// GinLogger 接收gin框架默认的日志\nfunc GinLogger() gin.HandlerFunc {\n\treturn func(c *gin.Context) {\n\t\tstart := time.Now()\n\t\tpath := c.Request.URL.Path\n\t\tquery := c.Request.URL.RawQuery\n\t\tc.Next()\n\n\t\tcost := time.Since(start)\n\t\tlg.Info(path,\n\t\t\tzap.Int("status", c.Writer.Status()),\n\t\t\tzap.String("method", c.Request.Method),\n\t\t\tzap.String("path", path),\n\t\t\tzap.String("query", query),\n\t\t\tzap.String("ip", c.ClientIP()),\n\t\t\tzap.String("user-agent", c.Request.UserAgent()),\n\t\t\tzap.String("errors", c.Errors.ByType(gin.ErrorTypePrivate).String()),\n\t\t\tzap.Duration("cost", cost),\n\t\t)\n\t}\n}\n\n// GinRecovery recover掉项目可能出现的panic，并使用zap记录相关日志\nfunc GinRecovery(stack bool) gin.HandlerFunc {\n\treturn func(c *gin.Context) {\n\t\tdefer func() {\n\t\t\tif err := recover(); err != nil {\n\t\t\t\t// Check for a broken connection, as it is not really a\n\t\t\t\t// condition that warrants a panic stack trace.\n\t\t\t\tvar brokenPipe bool\n\t\t\t\tif ne, ok := err.(*net.OpError); ok {\n\t\t\t\t\tif se, ok := ne.Err.(*os.SyscallError); ok {\n\t\t\t\t\t\tif strings.Contains(strings.ToLower(se.Error()), "broken pipe") || strings.Contains(strings.ToLower(se.Error()), "connection reset by peer") {\n\t\t\t\t\t\t\tbrokenPipe = true\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\thttpRequest, _ := httputil.DumpRequest(c.Request, false)\n\t\t\t\tif brokenPipe {\n\t\t\t\t\tlg.Error(c.Request.URL.Path,\n\t\t\t\t\t\tzap.Any("error", err),\n\t\t\t\t\t\tzap.String("request", string(httpRequest)),\n\t\t\t\t\t)\n\t\t\t\t\t// If the connection is dead, we can\'t write a status to it.\n\t\t\t\t\tc.Error(err.(error)) // nolint: errcheck\n\t\t\t\t\tc.Abort()\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif stack {\n\t\t\t\t\tlg.Error("[Recovery from panic]",\n\t\t\t\t\t\tzap.Any("error", err),\n\t\t\t\t\t\tzap.String("request", string(httpRequest)),\n\t\t\t\t\t\tzap.String("stack", string(debug.Stack())),\n\t\t\t\t\t)\n\t\t\t\t} else {\n\t\t\t\t\tlg.Error("[Recovery from panic]",\n\t\t\t\t\t\tzap.Any("error", err),\n\t\t\t\t\t\tzap.String("request", string(httpRequest)),\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t\tc.AbortWithStatus(http.StatusInternalServerError)\n\t\t\t}\n\t\t}()\n\t\tc.Next()\n\t}\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br"),s("span",{staticClass:"line-number"},[n._v("97")]),s("br"),s("span",{staticClass:"line-number"},[n._v("98")]),s("br"),s("span",{staticClass:"line-number"},[n._v("99")]),s("br"),s("span",{staticClass:"line-number"},[n._v("100")]),s("br"),s("span",{staticClass:"line-number"},[n._v("101")]),s("br"),s("span",{staticClass:"line-number"},[n._v("102")]),s("br"),s("span",{staticClass:"line-number"},[n._v("103")]),s("br"),s("span",{staticClass:"line-number"},[n._v("104")]),s("br"),s("span",{staticClass:"line-number"},[n._v("105")]),s("br"),s("span",{staticClass:"line-number"},[n._v("106")]),s("br"),s("span",{staticClass:"line-number"},[n._v("107")]),s("br"),s("span",{staticClass:"line-number"},[n._v("108")]),s("br"),s("span",{staticClass:"line-number"},[n._v("109")]),s("br"),s("span",{staticClass:"line-number"},[n._v("110")]),s("br"),s("span",{staticClass:"line-number"},[n._v("111")]),s("br"),s("span",{staticClass:"line-number"},[n._v("112")]),s("br"),s("span",{staticClass:"line-number"},[n._v("113")]),s("br"),s("span",{staticClass:"line-number"},[n._v("114")]),s("br"),s("span",{staticClass:"line-number"},[n._v("115")]),s("br"),s("span",{staticClass:"line-number"},[n._v("116")]),s("br"),s("span",{staticClass:"line-number"},[n._v("117")]),s("br"),s("span",{staticClass:"line-number"},[n._v("118")]),s("br"),s("span",{staticClass:"line-number"},[n._v("119")]),s("br"),s("span",{staticClass:"line-number"},[n._v("120")]),s("br"),s("span",{staticClass:"line-number"},[n._v("121")]),s("br"),s("span",{staticClass:"line-number"},[n._v("122")]),s("br"),s("span",{staticClass:"line-number"},[n._v("123")]),s("br"),s("span",{staticClass:"line-number"},[n._v("124")]),s("br"),s("span",{staticClass:"line-number"},[n._v("125")]),s("br"),s("span",{staticClass:"line-number"},[n._v("126")]),s("br"),s("span",{staticClass:"line-number"},[n._v("127")]),s("br"),s("span",{staticClass:"line-number"},[n._v("128")]),s("br"),s("span",{staticClass:"line-number"},[n._v("129")]),s("br"),s("span",{staticClass:"line-number"},[n._v("130")]),s("br"),s("span",{staticClass:"line-number"},[n._v("131")]),s("br"),s("span",{staticClass:"line-number"},[n._v("132")]),s("br"),s("span",{staticClass:"line-number"},[n._v("133")]),s("br"),s("span",{staticClass:"line-number"},[n._v("134")]),s("br"),s("span",{staticClass:"line-number"},[n._v("135")]),s("br"),s("span",{staticClass:"line-number"},[n._v("136")]),s("br"),s("span",{staticClass:"line-number"},[n._v("137")]),s("br")])]),s("p",[n._v("123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136")]),n._v(" "),s("h4",{attrs:{id:"_2-2-main-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-main-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_2-2-main-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("2.2 main.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package main\n\nimport (\n\t"fmt"\n\t"go.uber.org/zap"\n\t"my_web/logger"\n\t"my_web/settings"\n)\n\nfunc main() {\n\t// 1. 加载配置（viper配置管理）\n\tif err := settings.Init(); err != nil {\n\t\tfmt.Printf("init settings failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Println(settings.Conf)\n\tfmt.Println(settings.Conf.Name) // web_app\n\tfmt.Println(settings.Conf.LogConfig == nil)\n\t// 2. 初始化日志（zap日志库）\n\tif err := logger.Init(settings.Conf.LogConfig, settings.Conf.Mode); err != nil {\n\t\tfmt.Printf("init logger failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer zap.L().Sync()\n\tzap.L().Debug("logger init success...")\n\t// 3. 初始化MySQL连接（sqlx）\n\n\t// 4. 初始化Redis连接（go-redis）\n\n\t// 5. 注册路由\n\n\t// 6. 启动服务（优雅关机）\n\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br")])]),s("p",[n._v("12345678910111213141516171819202122232425262728293031323334")]),n._v(" "),s("h3",{attrs:{id:"_03-第三-初始化mysql连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_03-第三-初始化mysql连接"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_03-%E7%AC%AC%E4%B8%89-%E5%88%9D%E5%A7%8B%E5%8C%96mysql%E8%BF%9E%E6%8E%A5",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("03.第三: 初始化mysql连接")])]),n._v(" "),s("h4",{attrs:{id:"_3-1-dao-mysql-mysql-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-dao-mysql-mysql-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_3-1-dao-mysql-mysql-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("3.1 dao/mysql/mysql.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package mysql\n\nimport (\n\t"fmt"\n\t_ "github.com/go-sql-driver/mysql"\n\t"github.com/jmoiron/sqlx"\n\t"go.uber.org/zap"\n\t"web_app/settings"\n)\n\nvar db *sqlx.DB\n\nfunc Init(cfg *settings.MySQLConfig) (err error) {\n\tdsn := fmt.Sprintf("%s:%s@tcp(%s:%d)/%s?charset=utf8mb4&parseTime=True",\n\t\tcfg.User,\n\t\tcfg.Password,\n\t\tcfg.Host,\n\t\tcfg.Port,\n\t\tcfg.DbName,\n\t)\n\t// 也可以使用MustConnect连接不成功就panic\n\tdb, err = sqlx.Connect("mysql", dsn)\n\tif err != nil {\n\t\tzap.L().Error("connect DB failed", zap.Error(err))\n\t\treturn\n\t}\n\tdb.SetMaxOpenConns(cfg.MaxOpenConns)\n\tdb.SetMaxIdleConns(cfg.MaxIdleConns)\n\treturn\n}\n\nfunc Close() {\n\t_ = db.Close()\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br")])]),s("p",[n._v("12345678910111213141516171819202122232425262728293031323334")]),n._v(" "),s("h4",{attrs:{id:"_3-2-main-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-main-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_3-2-main-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("3.2 main.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package main\n\nimport (\n\t"fmt"\n\t"go.uber.org/zap"\n\t"my_web/dao/mysql"\n\t"my_web/logger"\n\t"my_web/settings"\n)\n\nfunc main() {\n\t// 1. 加载配置（viper配置管理）\n\tif err := settings.Init(); err != nil {\n\t\tfmt.Printf("init settings failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Println(settings.Conf)\n\tfmt.Println(settings.Conf.Name) // web_app\n\tfmt.Println(settings.Conf.LogConfig == nil)\n\t// 2. 初始化日志（zap日志库）\n\tif err := logger.Init(settings.Conf.LogConfig, settings.Conf.Mode); err != nil {\n\t\tfmt.Printf("init logger failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer zap.L().Sync()\n\tzap.L().Debug("logger init success...")\n\t// 3. 初始化MySQL连接（sqlx）\n\tif err := mysql.Init(settings.Conf.MySQLConfig); err != nil {\n\t\tfmt.Printf("init mysql failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer mysql.Close()\n\t// 4. 初始化Redis连接（go-redis）\n\n\t// 5. 注册路由\n\n\t// 6. 启动服务（优雅关机）\n\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br")])]),s("p",[n._v("123456789101112131415161718192021222324252627282930313233343536373839")]),n._v(" "),s("h3",{attrs:{id:"_04-初始化redis连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_04-初始化redis连接"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_04-%E5%88%9D%E5%A7%8B%E5%8C%96redis%E8%BF%9E%E6%8E%A5",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("04.初始化redis连接")])]),n._v(" "),s("h4",{attrs:{id:"_4-1-dao-redis-redis-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-dao-redis-redis-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_4-1-dao-redis-redis-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("4.1 dao/redis/redis.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package redis\nimport (\n\t"fmt"\n\t"web_app/settings"\n\t"github.com/go-redis/redis"\n)\n\n// 声明一个全局的rdb变量\nvar rdb *redis.Client\n\n// Init 初始化连接\nfunc Init(cfg *settings.RedisConfig) (err error) {\n\trdb = redis.NewClient(&redis.Options{\n\t\tAddr: fmt.Sprintf("%s:%d",\n\t\t\tcfg.Host,\n\t\t\tcfg.Port,\n\t\t),\n\t\tPassword: cfg.Password, // no password set\n\t\tDB:       cfg.DB,       // use default DB\n\t\tPoolSize: cfg.PoolSize,\n\t})\n\n\t_, err = rdb.Ping().Result()\n\treturn\n}\n\nfunc Close() {\n\t_ = rdb.Close()\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br")])]),s("p",[n._v("1234567891011121314151617181920212223242526272829")]),n._v(" "),s("h4",{attrs:{id:"_4-2-mian-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-mian-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_4-2-mian-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("4.2 mian.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package main\n\nimport (\n\t"fmt"\n\t"go.uber.org/zap"\n\t"my_web/dao/mysql"\n\t"my_web/dao/redis"\n\t"my_web/logger"\n\t"my_web/settings"\n)\n\nfunc main() {\n\t// 1. 加载配置（viper配置管理）\n\tif err := settings.Init(); err != nil {\n\t\tfmt.Printf("init settings failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Println(settings.Conf)\n\tfmt.Println(settings.Conf.Name) // web_app\n\tfmt.Println(settings.Conf.LogConfig == nil)\n\t// 2. 初始化日志（zap日志库）\n\tif err := logger.Init(settings.Conf.LogConfig, settings.Conf.Mode); err != nil {\n\t\tfmt.Printf("init logger failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer zap.L().Sync()\n\tzap.L().Debug("logger init success...")\n\t// 3. 初始化MySQL连接（sqlx）\n\tif err := mysql.Init(settings.Conf.MySQLConfig); err != nil {\n\t\tfmt.Printf("init mysql failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer mysql.Close()\n\t// 4. 初始化Redis连接（go-redis）\n\tif err := redis.Init(settings.Conf.RedisConfig); err != nil {\n\t\tfmt.Printf("init redis failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer redis.Close()\n\t// 5. 注册路由\n\n\t// 6. 启动服务（优雅关机）\n\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br")])]),s("p",[n._v("1234567891011121314151617181920212223242526272829303132333435363738394041424344")]),n._v(" "),s("h3",{attrs:{id:"_05-注册路由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_05-注册路由"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_05-%E6%B3%A8%E5%86%8C%E8%B7%AF%E7%94%B1",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("05.注册路由")])]),n._v(" "),s("h4",{attrs:{id:"_5-1-routes-routes-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-routes-routes-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_5-1-routes-routes-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("5.1 routes/routes.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package routes\nimport (\n\t"net/http"\n\t"web_app/logger"\n\t"web_app/settings"\n\t"github.com/gin-gonic/gin"\n)\n\nfunc Setup(mode string) *gin.Engine {\n\tif mode == gin.ReleaseMode {\n\t\tgin.SetMode(gin.ReleaseMode)\n\t}\n\tr := gin.New()\n\tr.Use(logger.GinLogger(), logger.GinRecovery(true))\n\n\tr.GET("/version", func(c *gin.Context) {\n\t\tc.String(http.StatusOK, settings.Conf.Version)\n\t})\n\treturn r\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br")])]),s("p",[n._v("1234567891011121314151617181920")]),n._v(" "),s("h4",{attrs:{id:"_5-2-main-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-main-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_5-2-main-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("5.2 main.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package main\n\nimport (\n\t"fmt"\n\t"go.uber.org/zap"\n\t"my_web/dao/mysql"\n\t"my_web/dao/redis"\n\t"my_web/logger"\n\t"my_web/routes"\n\t"my_web/settings"\n)\n\nfunc main() {\n\t// 1. 加载配置（viper配置管理）\n\tif err := settings.Init(); err != nil {\n\t\tfmt.Printf("init settings failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Println(settings.Conf)\n\tfmt.Println(settings.Conf.Name) // web_app\n\tfmt.Println(settings.Conf.LogConfig == nil)\n\t// 2. 初始化日志（zap日志库）\n\tif err := logger.Init(settings.Conf.LogConfig, settings.Conf.Mode); err != nil {\n\t\tfmt.Printf("init logger failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer zap.L().Sync()\n\tzap.L().Debug("logger init success...")\n\t// 3. 初始化MySQL连接（sqlx）\n\tif err := mysql.Init(settings.Conf.MySQLConfig); err != nil {\n\t\tfmt.Printf("init mysql failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer mysql.Close()\n\t// 4. 初始化Redis连接（go-redis）\n\tif err := redis.Init(settings.Conf.RedisConfig); err != nil {\n\t\tfmt.Printf("init redis failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer redis.Close()\n\t// 5. 注册路由\n\tr := routes.Setup(settings.Conf.Mode)\n\terr := r.Run(fmt.Sprintf(":%d", settings.Conf.Port))\n\tif err != nil {\n\t\tfmt.Printf("run server failed, err:%v\\n", err)\n\t\treturn\n\t}\n\t// 6. 启动服务（优雅关机）\n\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br")])]),s("p",[n._v("1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950")]),n._v(" "),s("h3",{attrs:{id:"_06-启动服务-优雅关机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_06-启动服务-优雅关机"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_06-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-%E4%BC%98%E9%9B%85%E5%85%B3%E6%9C%BA",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("06.启动服务(优雅关机)")])]),n._v(" "),s("h4",{attrs:{id:"_6-1-main-go"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-main-go"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_6-1-main-go",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("6.1 main.go")])]),n._v(" "),s("div",{staticClass:"language-Plain Text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-plain"}},[s("code",[n._v('package main\n\nimport (\n\t"context"  // 这个包需要手动的导入\n\t"fmt"\n\t"go.uber.org/zap"\n\t"log"\n\t"my_web/dao/mysql"\n\t"my_web/dao/redis"\n\t"my_web/logger"\n\t"my_web/routes"\n\t"my_web/settings"\n\t"net/http"\n\t"os"\n\t"os/signal"\n\t"syscall"\n\t"time"\n)\n\nfunc main() {\n\t// 1. 加载配置（viper配置管理）\n\tif err := settings.Init(); err != nil {\n\t\tfmt.Printf("init settings failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tfmt.Println(settings.Conf)\n\tfmt.Println(settings.Conf.Name) // web_app\n\tfmt.Println(settings.Conf.LogConfig == nil)\n\t// 2. 初始化日志（zap日志库）\n\tif err := logger.Init(settings.Conf.LogConfig, settings.Conf.Mode); err != nil {\n\t\tfmt.Printf("init logger failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer zap.L().Sync()\n\tzap.L().Debug("logger init success...")\n\t// 3. 初始化MySQL连接（sqlx）\n\tif err := mysql.Init(settings.Conf.MySQLConfig); err != nil {\n\t\tfmt.Printf("init mysql failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer mysql.Close()\n\t// 4. 初始化Redis连接（go-redis）\n\tif err := redis.Init(settings.Conf.RedisConfig); err != nil {\n\t\tfmt.Printf("init redis failed, err:%v\\n", err)\n\t\treturn\n\t}\n\tdefer redis.Close()\n\t// 5. 注册路由\n\t// 5. 注册路由\n\tr := routes.Setup(settings.Conf.Mode)\n\tr.Run()\n\t// 6. 启动服务（优雅关机）\n\tfmt.Println(settings.Conf.Port)\n\tsrv := &http.Server{\n\t\tAddr:    fmt.Sprintf(":%d", settings.Conf.Port),\n\t\tHandler: r,\n\t}\n\n\tgo func() {\n\t\t// 开启一个goroutine启动服务\n\t\tif err := srv.ListenAndServe(); err != nil && err != http.ErrServerClosed {\n\t\t\tlog.Fatalf("listen: %s\\n", err)\n\t\t}\n\t}()\n\n\t// 等待中断信号来优雅地关闭服务器，为关闭服务器操作设置一个5秒的超时\n\tquit := make(chan os.Signal, 1) // 创建一个接收信号的通道\n\t// kill 默认会发送 syscall.SIGTERM 信号\n\t// kill -2 发送 syscall.SIGINT 信号，我们常用的Ctrl+C就是触发系统SIGINT信号\n\t// kill -9 发送 syscall.SIGKILL 信号，但是不能被捕获，所以不需要添加它\n\t// signal.Notify把收到的 syscall.SIGINT或syscall.SIGTERM 信号转发给quit\n\tsignal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) // 此处不会阻塞\n\t<-quit                                               // 阻塞在此，当接收到上述两种信号时才会往下执行\n\tzap.L().Info("Shutdown Server ...")\n\t// 创建一个5秒超时的context\n\tctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\n\tdefer cancel()\n\t// 5秒内优雅关闭服务（将未处理完的请求处理完再关闭服务），超过5秒就超时退出\n\tif err := srv.Shutdown(ctx); err != nil {\n\t\tzap.L().Fatal("Server Shutdown", zap.Error(err))\n\t}\n\n\tzap.L().Info("Server exiting")\n}\n\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br")])]),s("p",[n._v("123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384")]),n._v(" "),s("h4",{attrs:{id:"_6-2-启动测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-启动测试"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_6-2-%E5%90%AF%E5%8A%A8%E6%B5%8B%E8%AF%95",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("6.2 启动测试")])]),n._v(" "),s("ul",[s("li",[s("p",[n._v("http://127.0.0.1:8080/version")])]),n._v(" "),s("li",[s("p",[n._v("修改 config.yaml 中的version配置，保存后就会在页面看到自动修改")])])]),n._v(" "),s("h4",{attrs:{id:"_6-3-使用golang-ide启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-使用golang-ide启动"}},[n._v("#")]),n._v(" "),s("a",{attrs:{href:"http://v5blog.cn/pages/6829fb/#_6-3-%E4%BD%BF%E7%94%A8golang-ide%E5%90%AF%E5%8A%A8",target:"_blank",rel:"noopener noreferrer"}},[n._v("#"),s("OutboundLink")],1),n._v(" "),s("strong",[n._v("6.3 使用golang ide启动")])]),n._v(" "),s("p",[s("img",{attrs:{src:t(691),alt:""}})]),n._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/Tom7481079/vuepress-blog-xiaonq/edit/master/docs/09.Go/09.GIN%E8%AE%BA%E5%9D%9B/08.web%E8%84%9A%E6%89%8B%E6%9E%B6.md",target:"_blank",rel:"noopener noreferrer"}},[n._v("编辑"),s("OutboundLink")],1),n._v("  (opens new window)")]),n._v(" "),s("p",[s("strong",[n._v("上次")])])])}),[],!1,null,null,null);s.default=e.exports},689:function(n,s,t){n.exports=t.p+"assets/img/2023052414013649.15bdffa5.png"},690:function(n,s,t){n.exports=t.p+"assets/img/202305241401376.f6f879c7.png"},691:function(n,s,t){n.exports=t.p+"assets/img/2023052414013776.0fe2a505.png"}}]);